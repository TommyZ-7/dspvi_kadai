<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>index</title>
  <script src="https://unpkg.com/@babel/standalone@7.26.4/babel.min.js"></script>
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom": "https://esm.sh/react-dom@19.0.0/client",
        "socket.io-client": "https://esm.sh/socket.io-client@4.8.1"
        }
    }

  </script>
  <script type="text/babel" data-type="module">
    import React, {useEffect} from "react"
    import { createRoot } from "react-dom"
    import { io } from "socket.io-client"


    const App = () => {


      const [ messages, setMessages ] = React.useState([]);

      useEffect(() => {
        const socket = io("http://localhost:5000");

        socket.emit("join", "test");

        socket.on("message_history", (history) => {
          setMessages(history);
          
        })
        socket.on("new_message", (message) => {
          setMessages(message);
        });
      }, []);

      const sendMessage = (e) => {

        const socket = io("http://localhost:5000");
        socket.emit("message", e);
      };

      return (
        <>
          <div>
            {messages.map((m, i) => (
              <div key={i}>{m}</div>
            ))}
          </div>
          <input type="text" onKeyPress={(e) => e.key === "Enter" && sendMessage(e.target.value)} />
          <button onClick={() => console.log(messages)}>
            テスト
          </button>
        </>
      );
      
    };
    const container = document.getElementById("app");
    const root = createRoot(container);
    root.render(<App />);
  </script>
</head>
<body>
  <div id="app"></div>
</body>
</html>
